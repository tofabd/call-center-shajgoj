<!DOCTYPE html>
<html>
<head>
    <title>Direct Pusher Test</title>
</head>
<body>
    <h1>Testing Direct Pusher Connection to Reverb</h1>
    <div id="status">Connecting...</div>
    <div id="messages"></div>

    <script src="https://unpkg.com/pusher-js@8.3.0/dist/web/pusher.min.js"></script>
    
    <script>
        const statusDiv = document.getElementById('status');
        const messagesDiv = document.getElementById('messages');

        function log(message) {
            console.log(message);
            messagesDiv.innerHTML += '<p>' + message + '</p>';
        }

        try {
            // Test direct Pusher connection to Reverb
            const pusher = new Pusher('otp1qepgz0gsohqgsypv', {
                wsHost: 'localhost',
                wsPort: 8080,
                wssPort: 8080,
                forceTLS: false,
                disableStats: true,
                enabledTransports: ['ws'],
                cluster: '',
                encrypted: false
            });

            pusher.connection.bind('connected', () => {
                statusDiv.innerHTML = '✅ Connected';
                log('Direct Pusher connected successfully');
            });
            
            pusher.connection.bind('disconnected', () => {
                statusDiv.innerHTML = '❌ Disconnected';
                log('Direct Pusher disconnected');
            });
            
            pusher.connection.bind('error', (error) => {
                statusDiv.innerHTML = '❌ Error';
                log('Direct Pusher error: ' + JSON.stringify(error));
            });

            pusher.connection.bind('state_change', (states) => {
                log('Direct Pusher state change: ' + JSON.stringify(states));
            });

            // Test channel subscription
            const channel = pusher.subscribe('call-console');
            
            channel.bind('pusher:subscription_succeeded', () => {
                log('Successfully subscribed to call-console channel');
            });

            log('Direct Pusher initialized, waiting for connection...');
        } catch (error) {
            statusDiv.innerHTML = '❌ Error';
            log('Error: ' + error.message);
        }
    </script>
</body>
</html>